---
import "../styles/global.css";
import "toastify-js/src/toastify.css";

const productData = {
    product_name: "Omidon",
    product_strength: "0.25 mg",
    quantity_ordered: 30,
    price: 249,
    full_price: 299,
    description:
        "interdum non dignissim eu, laoreet tincidunt augue. Vestibulum sed molestie vitae, sollicitudin ante vitae",
    subtitle: "Suspendisse in ante cursus",
    features: ["Rapid absorption formula", "Clinical grade ingredients"],
    commit_button_text: "Commit Order",
    promotional_banner: "https://dummyimage.com/536x190/04f/aaa",
};

const apiBase = import.meta.env.PUBLIC_ORDER_URL || "http://localhost";
const API_URL = `${apiBase}/orders/clinic-test-clinic/omidon`;
---

<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width" />
        <title>{productData.product_name} | Premium Weight Management</title>
    </head>
    <body class="bg-slate-50 text-slate-900 font-sans antialiased">
        <section
            class="max-w-6xl mx-auto px-6 py-16 lg:py-24 grid grid-cols-1 lg:grid-cols-2 gap-16 items-center"
        >
            <div class="order-2 lg:order-1">
                <div
                    class="inline-block px-3 py-1 rounded-full bg-blue-100 text-blue-700 text-xs font-bold tracking-widest uppercase mb-6"
                >
                    New Generation Formula
                </div>
                <h1
                    class="text-6xl font-black tracking-tight mb-4 text-slate-900"
                >
                    {productData.product_name}
                </h1>
                <h2 class="text-2xl text-slate-500 font-medium mb-6">
                    {productData.subtitle}
                </h2>

                <div class="flex items-center gap-4 mb-8">
                    <div class="text-4xl font-bold text-blue-600">
                        ${productData.price}
                    </div>
                    <div class="text-xl text-slate-400 line-through">
                        ${productData.full_price}
                    </div>
                    <div
                        class="bg-green-100 text-green-700 px-3 py-1 rounded-lg text-sm font-bold"
                    >
                        Save ${productData.full_price - productData.price}
                    </div>
                </div>

                <p class="text-lg text-slate-600 mb-8 leading-relaxed italic">
                    "{productData.description}"
                </p>

                <div class="space-y-4 mb-10">
                    {
                        productData.features.map((f) => (
                            <div class="flex items-center gap-3">
                                <div class="bg-blue-500 rounded-full p-1">
                                    <svg
                                        class="w-4 h-4 text-white"
                                        fill="none"
                                        stroke="currentColor"
                                        viewBox="0 0 24 24"
                                    >
                                        <path
                                            d="M5 13l4 4 L19 7"
                                            stroke-width="3"
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                        />
                                    </svg>
                                </div>
                                <span class="font-semibold text-slate-700">
                                    {f}
                                </span>
                            </div>
                        ))
                    }
                </div>

                <button
                    id="orderBtn"
                    class="group relative w-full bg-slate-900 text-white text-xl font-bold py-5 rounded-2xl transition-all hover:bg-blue-600 hover:shadow-2xl hover:-translate-y-1"
                >
                    {productData.commit_button_text}
                </button>
            </div>

            <div class="order-1 lg:order-2 relative">
                <div
                    class="absolute -top-10 -right-10 w-32 h-32 bg-blue-200 rounded-full blur-3xl opacity-50"
                >
                </div>
                <img
                    src={`https://dummyimage.com/728x450/1e293b/fff&text=${productData.product_name}`}
                    alt="Product"
                    class="relative rounded-3xl shadow-[0_20px_50px_rgba(0,0,0,0.1)] border-8 border-white w-full h-auto"
                />
                <img
                    src={productData.promotional_banner}
                    class="mt-8 rounded-xl w-full shadow-md"
                    alt="Promo"
                />
            </div>
        </section>

        <section class="bg-white py-20 border-y border-slate-200">
            <div class="max-w-4xl mx-auto px-6 text-center">
                <h2 class="text-3xl font-bold mb-12 text-slate-800">
                    Why choose {productData.product_name}?
                </h2>
                <div
                    class="overflow-hidden rounded-2xl border border-slate-200 shadow-sm"
                >
                    <table class="w-full text-left">
                        <thead class="bg-slate-50">
                            <tr>
                                <th class="p-4 font-bold">Features</th>
                                <th
                                    class="p-4 font-bold text-blue-600 text-center"
                                    >{productData.product_name}</th
                                >
                                <th
                                    class="p-4 font-bold text-slate-400 text-center"
                                    >Market Average</th
                                >
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-100">
                            <tr>
                                <td class="p-4 font-medium italic"
                                    >{productData.product_strength}</td
                                >
                                <td class="p-4 text-center text-green-500"
                                    >✔ Optimized</td
                                >
                                <td class="p-4 text-center text-red-400"
                                    >Standard</td
                                >
                            </tr>
                            <tr>
                                <td class="p-4 font-medium"
                                    >Quantity per cycle</td
                                >
                                <td class="p-4 text-center font-bold"
                                    >{productData.quantity_ordered} Units</td
                                >
                                <td class="p-4 text-center">30 Units</td>
                            </tr>
                            <tr>
                                <td class="p-4 font-medium">Pricing</td>
                                <td
                                    class="p-4 text-center text-blue-600 font-bold"
                                    >${productData.price}</td
                                >
                                <td class="p-4 text-center"
                                    >${productData.full_price}+</td
                                >
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <section class="py-20 max-w-6xl mx-auto px-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                {
                    [1, 2, 3].map((i) => (
                        <div class="bg-white p-8 rounded-2xl shadow-sm border border-slate-100">
                            <div class="flex text-yellow-400 mb-4">
                                {"★".repeat(5)}
                            </div>
                            <p class="text-slate-600 mb-6 italic">
                                "The {productData.product_name} process was
                                seamless. Seeing great results within the first
                                month."
                            </p>
                            <div class="font-bold text-slate-900">
                                Verified Customer #{i}04
                            </div>
                        </div>
                    ))
                }
            </div>
        </section>

        <footer
            class="py-12 text-center text-slate-400 text-sm border-t border-slate-200"
        >
            © 2026 SemaMelt Health Labs. All rights reserved.
        </footer>

        <script is:inline define:vars={{ productData, API_URL }}>
            window.__PAGE_DATA__ = { productData, API_URL };
        </script>
        <script>
            import Toastify from "toastify-js";

            const showError = (message: string) => {
                Toastify({
                    text: message,
                    duration: 4000,
                    close: true,
                    gravity: "top",
                    position: "right",
                    stopOnFocus: true,
                    style: {
                        background:
                            "linear-gradient(to right, #ef4444, #dc2626)",
                        borderRadius: "12px",
                        fontWeight: "600",
                    },
                }).showToast();
            };

            const showSuccess = (message: string) => {
                Toastify({
                    text: message,
                    duration: 3000,
                    gravity: "top",
                    position: "right",
                    style: {
                        background:
                            "linear-gradient(to right, #16a34a, #15803d)",
                        borderRadius: "12px",
                        fontWeight: "600",
                    },
                }).showToast();
            };

            const initOrderButton = () => {
                const { productData, API_URL } = window.__PAGE_DATA__;
                const btn = document.getElementById(
                    "orderBtn",
                ) as HTMLButtonElement;

                if (!btn) {
                    console.error("Order button not found.");
                    return;
                }

                btn.addEventListener("click", async () => {
                    const originalText = btn.innerText;
                    btn.disabled = true;
                    btn.innerText = "Processing Your Order...";

                    try {
                        const response = await fetch(API_URL, {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                            },
                            body: JSON.stringify(productData),
                        });

                        let data: { message?: string; redirect_url?: string } =
                            {};
                        try {
                            data = await response.json();
                        } catch {
                            data = {};
                        }

                        if (!response.ok) {
                            // Handle API errors
                            showError(data.message || "Something went wrong");
                            return;
                        }

                        if (data.redirect_url) {
                            setTimeout(() => {
                                window.location.href = data.redirect_url;
                            }, 1200);
                        }
                    } catch (e) {
                        console.error("Error:", e);
                        showError("Network error. Please try again later.");
                    } finally {
                        if (btn) {
                            btn.disabled = false;
                            btn.innerText = originalText;
                        }
                    }
                });
            };

            if (document.readyState === "loading") {
                document.addEventListener("DOMContentLoaded", initOrderButton);
            } else {
                initOrderButton();
            }
        </script>
    </body>
</html>
